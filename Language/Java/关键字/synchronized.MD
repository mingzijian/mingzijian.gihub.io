synchronized 修饰符
------------------------------
synchronized 关键字，给对象或实例加锁。
当它锁定一个方法或者一个代码块的时候，同一时刻最多只有一个线程执行这段代码。
当两个并发线程访问同一个对象object中的这个加锁同步代码块时，一个时间内只能有一个线程得到执行。另一个线程必须等待当前线程执行完这个代码块以后才能执行该代码块。
然而，当一个线程访问object的一个加锁代码块时，另一个线程仍可以访问该object中的非加锁代码块。

### 使用形式
#### 修饰实例方法
锁定的是当前实例对象
#### 修饰静态方法
锁定的是当前类Class对象
#### 修饰代码块
锁定的是指定的对象，指定的对象可以是实例对象也可以是类对象。

### 原理
#### synchronized的执行过程：
1. 检测Mark Word里面是不是当前线程的ID，如果是，表示当前线程处于偏向锁
2. 如果不是，则使用CAS将当前线程的ID替换Mard Word，如果成功则表示当前线程获得偏向锁，置偏向标志为1
3. 如果失败，则说明发生竞争，撤销偏向锁，进而升级为轻量级锁。
4. 当前线程使用CAS将对象头的Mark Word替换为锁记录指针，如果成功，当前线程获得锁
5. 如果失败，表示其他线程竞争锁，当前线程便尝试使用自旋来获取锁。
6. 如果自旋成功则依然处于轻量级状态。
7. 如果自旋失败，则升级为重量级锁。

#### 字节码层面
monitorenter 开启锁
monitorexit 释放锁（正常返回/异常退出）

### 锁升级
synchronized锁的4种状态：
- 无锁状态 
- 偏向锁状态
- 轻量级锁状态
- 重量级锁状态


| 锁状态|  假定情况|  竞争处理策略|
| ---- | ---- | ---- |
|偏向锁| 假定获取锁的一直都是同一个线程| 升级为轻量锁|
|轻量级锁| 假定锁被占用时不会有其他线程获取| 自旋等待，超时升级|
|重量级锁| 最坏情况，经常发生竞争| 直接将要获取锁的线程挂起|



#### 偏向锁
##### jvm开启/关闭偏向锁
- 开启偏向锁：
`-XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0`
- 关闭偏向锁：
`-XX:-UseBiasedLocking`

#### 轻量级锁

#### 重量级锁

### 锁优化