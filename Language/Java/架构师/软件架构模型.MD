软件架构模型
-------------------

## C4模型

C4 模型是由一系列分层的软件架构图组成，这些架构图用于描述上下文、容器、组件和代码。
C4 模型的层次结构提供了不同的抽象级别，每种抽象级别都与不同的受众有关。
同时，C4 模型也是向软件开发团队介绍轻量级建模的一种方式。

C4 模型使用 容器（应用程序、数据存储、微服务等）、组件 和 代码 来描述一个软件系统的静态结构。它还考虑到使用软件系统的人。

![An overview of the C4 model](https://gitee.com/mingzijian/resources/raw/master/picgo/c4-overview.png)

### C4模型核心图

#### 上下文（Context）
系统上下文图显示了你正在构建的软件系统，以及系统与用户及其他软件系统之间的关系。

在这一层级中细节并不重要，只需要显示系统概况。 

重点应该放在人员（角色）和软件系统上，而不是技术，协议和其他低层级细节上，从而使非技术人员也能够看得懂。这个图也是明确需求的重要图示。

以下是一个系统上下文图的示例，描述了一个互联网银行系统的系统上下文：
 ![img](https://gitee.com/mingzijian/resources/raw/master/picgo/c4-4-1529935843626.jpg)


银行的个人客户使用互联网银行系统查看有关银行账户的信息并进行支付。互联网银行系统使用银行现有的大型机银行系统来执行此操作，并使用银行现有的电子邮件系统向客户发送电子邮件。图中的颜色表示哪些软件系统已经存在（灰色）以及待构建的系统（蓝色）。

#### 容器（Container）
容器图将软件系统放大，显示组成该软件系统的容器（应用程序、数据存储、微服务等）。
技术决策也是该图的关键部分。

“容器”类似于服务器端Web应用程序，单页应用程序，桌面应用程序，移动应用程序，数据库架构，文件系统等。

本质上，容器是可单独运行/可部署的单元（例如，单独的进程空间） ）执行代码或存储数据。

容器图显示了软件体系结构的高层结构以及如何在其间分配职责。 它还显示了主要的技术选择以及容器之间的通信方式。

以下是互联网银行系统的容器图示例。它显示了互联网银行系统（虚线框）由五个容器组成：服务器端 Web 应用程序、客户端单页面应用程序、移动应用程序、服务器端 API 应用程序和数据库。
 ![img](https://gitee.com/mingzijian/resources/raw/master/picgo/c4-5-1529934730161.jpg)

Web 应用程序是一个 Java/Spring MVC Web 应用程序，它仅提供静态内容（HTML、CSS 和 JavaScript），包括组成单页应用程序的内容。单页面应用程序是一个运行在客户网络浏览器中的 Angular 应用程序，提供所有的网上银行功能。或者，客户可以使用跨平台 Xamarin 移动应用程序访问互联网银行的部分功能。单页应用程序和移动应用程序都调用 JSON/HTTPS API，这是由服务器端运行的另一个 Java/Spring MVC 应用程序提供的。API 应用程序从数据库中获取用户信息（关系数据库模式）。API 应用程序还使用专有的 XML/HTTPS 接口与现有的大型机银行系统进行通信，以获取有关银行账户或交易的信息。如果需要向客户发送电子邮件，API 应用程序还会调用现有的电子邮件系统。

#### 组件（Component）
组件图，将单个容器放大，以显示其中的组件。这些组件映射到代码库中的真实抽象（例如一组代码）。

组件图显示了容器如何由多个“组件”组成，每个组件是什么，它们的职责以及技术/实现接口（API）或者细节。

下面是一个虚拟的网上银行系统的组件图示例，显示了 API 应用程序中的一些组件（而不是全部）。
 ![img](https://gitee.com/mingzijian/resources/raw/master/picgo/c4-6-1529935329999.jpg)

两个 Spring MVC REST 控制器为 JSON/HTTPS API 提供访问点，每个控制器随后使用其他组件访问数据库和大型机银行系统中的数据。

#### 代码（Code）
如果有必要，可以放大个别组件，以显示该组件的实现方式。

这一层是可选的，可以使用UML类图，实体关系图或类似的图。

理想情况下，该图可以使用工具（例如IDE或UML建模工具）自动生成。

以下是一个虚拟的网上银行系统的 UML 类图示例（部分），显示了组成 MainframeBankingSystemFacade 组件的代码元素（接口和类）。
 ![img](https://gitee.com/mingzijian/resources/raw/master/picgo/c4-7-1529935331734.jpg)

它表明该组件由很多类组成，实现细节直接反映了代码。我并不建议创建在这种详细程度的图表，有时候你可以直接从大多数 IDE 中获取它们。


### 参考
- [用于可视化软件架构的 C4 模型 (c4model.com)](https://c4model.com/)
- [Simon Brown - Coding the Architecture](http://www.codingthearchitecture.com/authors/sbrown/)

